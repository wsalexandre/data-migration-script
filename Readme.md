# Data Migration Script

This project contains a CLI-based data migration tool to import customer data from legacy CSV files into a MySQL relational database.

## Project Structure

```
├── src/
│   ├── entities/               # TypeORM entity definitions
│   ├── migrators/              # OO classes that encapsulate migration logic
│   │   ├── UnitFacilityMigrator.ts
│   │   └── RentRollMigrator.ts
│   ├── scripts/
│   │   └── migrate.ts          # Orchestration script that executes both migrations
│   ├── utils/
│   │   └── logger.service.ts   # Shared logger for structured logs
├── seeds/data/                 # Contains unit.csv and rentRoll.csv
├── logs/                       # Output logs (e.g., unit_migration.log, rentroll_migration.log)
```

## How to Run

1. Ensure `.env` is configured:
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=yourpassword
DB_DATABASE=migration_lab

2. Run the migration:
npx ts-node src/scripts/migrate.ts

## What It Does

### Unit & Facility Migration
* Parses `unit.csv`
* Extracts and validates `unitSize`
* Creates `Facility` and `Unit` entities
* Skips rows with missing or malformed data
* Logs new insertions and problems

### Rent Roll Migration
* Parses `rentRoll.csv`
* Validates and creates:
  * `Tenant`
  * `RentalContract`
  * `RentalInvoice`
* Validates foreign key references to `Unit`
* Skips rows with missing fields or orphaned relationships

## Validations
* Required fields present
* Valid `unitSize` (format: `WxLxH`)
* Email, dates and numbers are parsed correctly
* Checks existence of `facilityName + unitNumber` pair
* Logs malformed or orphaned rows

## Logs
All migration activity is logged to the `logs/` folder, including:

* Migration start and end time
* Skipped rows and reasons
* Errors
* Inserted records

## Idempotency & Safety
* Duplicate facilities are avoided using name lookup
* Units are inserted freshly (no check for existing units by number)
* Transaction is used in each migrator to guarantee atomicity
* Logging supports retry and auditing

## Assumptions
* `unitId` and `rentalContractId` are autogenerated manually for test/demo purposes
* `unitNumber` is unique within each facility
* CSV files are valid UTF-8 and well-structured